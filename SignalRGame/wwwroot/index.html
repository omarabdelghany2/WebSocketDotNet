<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SignalR Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>
</head>
<body>
    <h1>SignalR Game</h1>
    <button id="createRoom">Create Room</button>
    <button id="joinRoom">Join Room</button>
    <input id="roomId" placeholder="Room ID" />
    <button id="startGame" disabled>Start Game</button>
    <button id="sendMessage">Send Message</button>
    <input id="message" placeholder="Message" />
    <div id="log"></div>

    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("http://localhost:5274/gamehub") // Update with your server's address
            .withAutomaticReconnect()
            .build();

        let isHost = false;

        // SignalR event handlers
        connection.on("RoomCreated", (roomId) => {
            log(`Room created: ${roomId}`);
            document.getElementById("startGame").disabled = false; // Enable Start Game button for host
            isHost = true;
        });

        connection.on("PlayerJoined", (playerId) => {
            log(`Player joined: ${playerId}`);
        });

        connection.on("ReceiveMessage", (playerId, message) => {
            log(`${playerId}: ${message}`);
        });

        connection.on("GameStarted", () => {
            log("The game has started!");
        });

        connection.on("RoomDeleted", () => {
            log("The room has been deleted as the host left.");
            disableGameControls();
        });

        connection.on("Error", (message) => {
            log(`Error: ${message}`);
        });

        connection.start()
            .then(() => log("Connected to SignalR"))
            .catch(err => log(`Error: ${err}`));

        // Button click handlers
        document.getElementById("createRoom").onclick = () => {
            const roomId = prompt("Enter Room ID:");
            connection.invoke("CreateRoom", roomId)
                .catch(err => log(`Error: ${err}`));
        };

        document.getElementById("joinRoom").onclick = () => {
            const roomId = document.getElementById("roomId").value;
            connection.invoke("JoinRoom", roomId)
                .catch(err => log(`Error: ${err}`));
        };

        document.getElementById("startGame").onclick = () => {
            const roomId = document.getElementById("roomId").value;
            if (isHost) {
                connection.invoke("StartGame", roomId)
                    .catch(err => log(`Error: ${err}`));
            } else {
                log("Only the host can start the game.");
            }
        };

        document.getElementById("sendMessage").onclick = () => {
            const roomId = document.getElementById("roomId").value;
            const message = document.getElementById("message").value;
            connection.invoke("SendMessageToRoom", roomId, message)
                .catch(err => log(`Error: ${err}`));
        };

        // Utility function to log messages
        function log(message) {
            const logDiv = document.getElementById("log");
            const p = document.createElement("p");
            p.textContent = message;
            logDiv.appendChild(p);
        }

        // Disable controls if the host leaves
        function disableGameControls() {
            document.getElementById("startGame").disabled = true;
            isHost = false;
        }
    </script>
</body>
</html>
